<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Shopping List - Meal Planner</title>
    <link rel="stylesheet" href="css/style.css?v=1">
</head>
<body>
    <div class="main-layout">
        <!-- Sidebar will be loaded by sidebar.js -->

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <div class="page-header">
                    <h1>üõí Danh s√°ch mua s·∫Øm</h1>
                   
                </div>

                <!-- Recipe Selector -->
                <div class="recipe-selector">
                    <!-- Search Bar -->
                    <div class="search-section">
                        <label>T√¨m ki·∫øm m√≥n ƒÉn:</label>
                        <input type="text" id="recipe-search" placeholder="Nh·∫≠p t√™n m√≥n ƒÉn..." class="search-input" oninput="filterRecipes()">
                        </div>

                    <!-- Filter Buttons -->
                    <div class="filter-section">
                        <label>L·ªçc theo lo·∫°i:</label>
                        <div class="filter-buttons">
                            <button class="filter-btn active" onclick="setFilter('all')" data-filter="all">
                                T·∫•t c·∫£
                            </button>
                            <button class="filter-btn" onclick="setFilter('Breakfast')" data-filter="Breakfast">
                                üç≥ S√°ng
                            </button>
                            <button class="filter-btn" onclick="setFilter('Lunch')" data-filter="Lunch">
                                üçú Tr∆∞a
                            </button>
                            <button class="filter-btn" onclick="setFilter('Dinner')" data-filter="Dinner">
                                üçΩÔ∏è T·ªëi
                            </button>
                            
                        </div>
                    </div>

                    <!-- Recipe Count -->
                    <div id="recipe-count" style="margin-top: 15px; color: #666; font-size: 0.95em; font-weight: 500;">
                        T·ªïng: <span id="recipe-count-number">0</span> m√≥n ƒÉn
                    </div>
                </div>

                <!-- Recipes Grid -->
                <div id="recipes-grid" class="recipes-grid"></div>

                <!-- Pagination -->
                <div id="pagination" class="pagination" style="display: none;">
                    <button id="prev-btn" class="pagination-btn" onclick="prevPage()" disabled>‚Üê Tr∆∞·ªõc</button>
                    <div id="page-info" class="page-info"></div>
                    <button id="next-btn" class="pagination-btn" onclick="nextPage()" disabled>Sau ‚Üí</button>
                </div>

                <!-- Shopping List -->
                <div id="shopping-content" class="shopping-content">
                    <div class="empty-state">
                        <p>üçΩÔ∏è Ch·ªçn m√≥n ƒÉn ƒë·ªÉ xem nguy√™n li·ªáu c·∫ßn mua</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="js/config.js?v=4"></script>
    <script src="js/api.js?v=4"></script>
    <script src="js/utils.js?v=4"></script>
    <script src="js/sidebar.js?v=4"></script>
    <script>
        checkAuth();
        setupPageReloadOnResume(); // T·ª± ƒë·ªông reload khi ƒë·ªïi user
        
        // Ki·ªÉm tra n·∫øu l√† admin th√¨ redirect v·ªÅ trang admin
        async function checkUserRole() {
            try {
                const user = await apiGetCurrentUser();
                if (user.role === 'admin') {
                    window.location.href = 'admin.html';
                    return;
                }
            } catch (error) {
                console.error('Error checking user role:', error);
            }
        }
        checkUserRole();
        
        // Render sidebar chung
        renderSidebar('shopping').catch(console.error);

        let allRecipes = [];
        let filteredRecipes = [];
        let currentFilter = 'all';
        let searchQuery = '';
        let recipePurchaseStatus = {}; // Map recipe_id -> {total: number, purchased: number, isComplete: boolean}
        
        // Pagination variables
        let currentPage = 1;
        let totalPages = 1;
        const RECIPES_PER_PAGE = 12;

        // Load recipes on page load
        window.onload = function() {
            loadRecipesForSelect();
        };

        // Load recipes for dropdown
        async function loadRecipesForSelect() {
            try {
                allRecipes = await apiGetRecipes({});
                await loadPurchaseStatus();
                filterRecipes();
            } catch (error) {
                console.error('Error loading recipes:', error);
                showToast('L·ªói t·∫£i danh s√°ch m√≥n ƒÉn: ' + error.message, 'error');
            }
        }

        // Load purchase status for all recipes
        async function loadPurchaseStatus() {
            try {
                // Load all shopping items
                const allItems = await apiGetShoppingListItems();
                
                // Group by recipe_id
                recipePurchaseStatus = {};
                allItems.forEach(item => {
                    if (item.recipe_id) {
                        if (!recipePurchaseStatus[item.recipe_id]) {
                            recipePurchaseStatus[item.recipe_id] = {
                                total: 0,
                                purchased: 0,
                                isComplete: false
                            };
                        }
                        recipePurchaseStatus[item.recipe_id].total++;
                        if (item.is_purchased) {
                            recipePurchaseStatus[item.recipe_id].purchased++;
                        }
                    }
                });
                
                // Check if complete
                Object.keys(recipePurchaseStatus).forEach(recipeId => {
                    const status = recipePurchaseStatus[recipeId];
                    status.isComplete = status.total > 0 && status.purchased === status.total;
                });
            } catch (error) {
                console.error('Error loading purchase status:', error);
            }
        }

        // Set filter by category
        function setFilter(category) {
            currentFilter = category;
            
            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-filter="${category}"]`).classList.add('active');
            
            filterRecipes();
        }

        // Filter recipes by search and category
        function filterRecipes() {
            searchQuery = document.getElementById('recipe-search').value.toLowerCase().trim();
            
            // Reset to page 1 when filtering
            currentPage = 1;
            
            // Filter by category
            if (currentFilter === 'all') {
                filteredRecipes = allRecipes;
            } else {
                filteredRecipes = allRecipes.filter(recipe => {
                    if (!recipe.tags) return false;
                    const tags = recipe.tags.split(',').map(t => t.trim());
                    return tags.includes(currentFilter);
                });
            }
            
            // Filter by search query
            if (searchQuery) {
                filteredRecipes = filteredRecipes.filter(recipe => {
                    return recipe.name.toLowerCase().includes(searchQuery);
                });
            }
            
            // Render recipe cards
            renderRecipeCards();
        }

        // Get recipe icon by category
        function getRecipeIcon(category) {
            const icons = {
                'Breakfast': 'üç≥',
                'Lunch': 'üçú',
                'Dinner': 'üçΩÔ∏è',
                'Snack': 'üç™'
            };
            return icons[category] || 'üç¥';
        }

        // Render recipe cards with pagination
        function renderRecipeCards() {
            const grid = document.getElementById('recipes-grid');
            
            // Update count
            document.getElementById('recipe-count-number').textContent = filteredRecipes.length;
            
            if (filteredRecipes.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <p>üîç Kh√¥ng t√¨m th·∫•y m√≥n ƒÉn n√†o</p>
                        <p>Th·ª≠ t√¨m ki·∫øm ho·∫∑c l·ªçc kh√°c</p>
                    </div>
                `;
                document.getElementById('pagination').style.display = 'none';
                return;
            }
            
            // Calculate pagination
            totalPages = Math.ceil(filteredRecipes.length / RECIPES_PER_PAGE);
            currentPage = Math.min(currentPage, totalPages) || 1;
            
            // Get recipes for current page
            const startIndex = (currentPage - 1) * RECIPES_PER_PAGE;
            const endIndex = startIndex + RECIPES_PER_PAGE;
            const recipesToShow = filteredRecipes.slice(startIndex, endIndex);
            
            grid.innerHTML = recipesToShow.map(recipe => {
                // Extract category from tags
                const category = recipe.tags ? recipe.tags.split(',')[0] : 'Lunch';
                const icon = getRecipeIcon(category);
                const avgRating = recipe.average_rating || 0;
                const stars = '‚≠ê'.repeat(Math.round(avgRating));
                
                // Check purchase status
                const purchaseStatus = recipePurchaseStatus[recipe.id];
                const isComplete = purchaseStatus && purchaseStatus.isComplete;
                const purchasedBadge = isComplete 
                    ? `<div class="purchased-badge" title="ƒê√£ mua ƒë·ªß nguy√™n li·ªáu">‚úÖ ƒê√£ mua ƒë·ªß</div>`
                    : '';
                
                return `
                    <div class="recipe-card ${isComplete ? 'recipe-complete' : ''}" onclick="loadRecipeIngredients(${recipe.id})">
                        <div class="recipe-image">${icon}</div>
                        ${purchasedBadge}
                        <div class="recipe-body">
                            <div class="recipe-title">${recipe.name}</div>
                            <div class="recipe-meta">
                                <span>‚è±Ô∏è ${recipe.prep_time || 30} ph√∫t</span>
                                <span>üî• ${Math.round(recipe.calories || 0)} kcal</span>
                            </div>
                            ${avgRating > 0 ? `<div class="recipe-rating">${stars} ${avgRating.toFixed(1)}</div>` : ''}
                            <div class="recipe-tags">
                                <span class="tag">${category}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Update pagination
            updatePagination();
        }

        // Update pagination controls
        function updatePagination() {
            const paginationDiv = document.getElementById('pagination');
            const pageInfo = document.getElementById('page-info');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            if (totalPages <= 1) {
                paginationDiv.style.display = 'none';
                return;
            }
            
            paginationDiv.style.display = 'flex';
            pageInfo.textContent = `Trang ${currentPage} / ${totalPages} (${filteredRecipes.length} m√≥n)`;
            
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;
        }

        // Pagination functions
        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderRecipeCards();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function nextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                renderRecipeCards();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Map l∆∞u shopping list items (item_id -> shopping_list_item_id)
        const shoppingItemsMap = {};
        let currentRecipeId = null;

        // Load ingredients for selected recipe
        async function loadRecipeIngredients(recipeId) {
            currentRecipeId = recipeId;
            try {
                // Get recipe details
                const recipe = await apiGetRecipe(parseInt(recipeId));
                
                // Display ingredients
                if (!recipe.ingredients || recipe.ingredients.length === 0) {
                    document.getElementById('shopping-content').innerHTML = `
                    <div class="empty-state">
                            <p>‚ö†Ô∏è M√≥n ƒÉn n√†y ch∆∞a c√≥ nguy√™n li·ªáu</p>
                    </div>
                `;
                return;
            }

                // T·∫°o shopping list items trong database (ch·ªâ t·∫°o n·∫øu ch∆∞a c√≥)
                try {
                    const result = await apiCreateShoppingListFromRecipe(recipeId);
                    // N·∫øu ƒë√£ c√≥ items r·ªìi, s·ª≠ d·ª•ng items t·ª´ response
                    if (result.already_exists && result.items) {
                        // C·∫≠p nh·∫≠t purchase status ngay t·ª´ response
                        const total = result.items.length;
                        const purchased = result.items.filter(item => item.is_purchased).length;
                        const isComplete = total > 0 && purchased === total;
                        
                        recipePurchaseStatus[recipeId] = {
                            total: total,
                            purchased: purchased,
                            isComplete: isComplete
                        };
                    }
                } catch (error) {
                    console.log('Shopping list items c√≥ th·ªÉ ƒë√£ t·ªìn t·∫°i:', error);
                }

                // Load shopping list items t·ª´ database
                let shoppingItems = [];
                try {
                    shoppingItems = await apiGetShoppingListItems(recipeId);
                    
                    // Lu√¥n c·∫≠p nh·∫≠t purchase status (k·ªÉ c·∫£ khi ƒë√£ c√≥ trong map)
                    if (shoppingItems.length > 0) {
                        const total = shoppingItems.length;
                        const purchased = shoppingItems.filter(item => item.is_purchased).length;
                        const isComplete = total > 0 && purchased === total;
                        
                        recipePurchaseStatus[recipeId] = {
                            total: total,
                            purchased: purchased,
                            isComplete: isComplete
                        };
                        
                        // Re-render cards to update badge
                        renderRecipeCards();
                    } else {
                        // N·∫øu kh√¥ng c√≥ items, x√≥a status
                        delete recipePurchaseStatus[recipeId];
                        renderRecipeCards();
                    }
                } catch (error) {
                    console.error('Error loading shopping items:', error);
                }

                // T·∫°o map: ingredient_name -> shopping_item
                const shoppingItemsByName = {};
                shoppingItems.forEach(item => {
                    shoppingItemsByName[item.ingredient_name] = item;
                });

                // Render ingredients v·ªõi tr·∫°ng th√°i t·ª´ database
                const ingredientsList = recipe.ingredients.map((ing, index) => {
                    const safeId = `ing-${recipeId}-${index}`;
                    const shoppingItem = shoppingItemsByName[ing.name];
                    const isPurchased = shoppingItem ? shoppingItem.is_purchased : false;
                    const itemId = shoppingItem ? shoppingItem.id : null;
                    
                    // L∆∞u mapping
                    shoppingItemsMap[safeId] = itemId;
                
                return `
                        <div class="ingredient-item ${isPurchased ? 'purchased' : ''}">
                            <input type="checkbox" id="${safeId}" ${isPurchased ? 'checked' : ''} 
                                   onchange="toggleIngredient(this, ${itemId})" 
                                   ${itemId ? '' : 'disabled'}>
                        <label for="${safeId}">
                                <span class="ing-name">${ing.name}</span>
                                <span class="ing-amount">${ing.amount} ${ing.unit}</span>
                        </label>
                    </div>
                `;
            }).join('');

                const purchasedCount = shoppingItems.filter(item => item.is_purchased).length;
                const totalCount = recipe.ingredients.length;

                document.getElementById('shopping-content').innerHTML = `
                <div class="shopping-summary">
                    <h3>üìä T·ªïng quan</h3>
                        <p><strong>${totalCount}</strong> nguy√™n li·ªáu c·∫ßn mua</p>
                        <p><strong>${purchasedCount}</strong> ƒë√£ mua / <strong>${totalCount - purchasedCount}</strong> ch∆∞a mua</p>
                        <p><strong>1</strong> m√≥n ƒÉn</p>
                </div>

                <div class="shopping-section">
                        <h3>üõí Danh s√°ch nguy√™n li·ªáu cho "${recipe.name}"</h3>
                    <div class="ingredients-checklist">
                        ${ingredientsList}
                    </div>
                </div>

                <div class="shopping-section">
                        <h3>üìñ Th√¥ng tin m√≥n ƒÉn</h3>
                        <div class="recipe-detail-info">
                            <p><strong>M√¥ t·∫£:</strong> ${recipe.description || 'Kh√¥ng c√≥ m√¥ t·∫£'}</p>
                            <p><strong>Th·ªùi gian chu·∫©n b·ªã:</strong> ${recipe.prep_time || 30} ph√∫t</p>
                            <p><strong>S·ªë ph·∫ßn:</strong> ${recipe.servings || 1}</p>
                            ${recipe.calories ? `<p><strong>Calories:</strong> ${Math.round(recipe.calories)} kcal/ph·∫ßn</p>` : ''}
                        </div>
                    </div>
                `;
                
                // Scroll to shopping content
                document.getElementById('shopping-content').scrollIntoView({ behavior: 'smooth', block: 'start' });
            } catch (error) {
                console.error('Error loading recipe ingredients:', error);
                showToast('L·ªói t·∫£i nguy√™n li·ªáu: ' + error.message, 'error');
                document.getElementById('shopping-content').innerHTML = `
                    <div class="empty-state">
                        <p>‚ùå L·ªói: ${error.message}</p>
                </div>
                `;
            }
        }


        async function toggleIngredient(checkbox, itemId) {
            if (!itemId) {
                showToast('Vui l√≤ng ƒë·ª£i t·∫£i d·ªØ li·ªáu...', 'error');
                checkbox.checked = !checkbox.checked;
                return;
            }

            const label = checkbox.nextElementSibling;
            const ingredientItem = checkbox.closest('.ingredient-item');
            const isPurchased = checkbox.checked;

            try {
                // C·∫≠p nh·∫≠t database
                await apiUpdateShoppingListItem(itemId, isPurchased);
                
                // C·∫≠p nh·∫≠t UI
                if (isPurchased) {
                label.style.textDecoration = 'line-through';
                label.style.opacity = '0.5';
                    ingredientItem.classList.add('purchased');
            } else {
                label.style.textDecoration = 'none';
                label.style.opacity = '1';
                    ingredientItem.classList.remove('purchased');
                }
                
                // C·∫≠p nh·∫≠t t·ªïng quan
                updateShoppingSummary();
                
                // C·∫≠p nh·∫≠t purchase status v√† render l·∫°i cards
                await updatePurchaseStatusForCurrentRecipe();
            } catch (error) {
                console.error('Error updating shopping item:', error);
                showToast('L·ªói c·∫≠p nh·∫≠t: ' + error.message, 'error');
                // Revert checkbox
                checkbox.checked = !isPurchased;
            }
        }

        // Update purchase status for current recipe
        async function updatePurchaseStatusForCurrentRecipe() {
            if (!currentRecipeId) return;
            
            try {
                // Reload purchase status for this recipe
                const items = await apiGetShoppingListItems(currentRecipeId);
                if (items.length > 0) {
                    const total = items.length;
                    const purchased = items.filter(item => item.is_purchased).length;
                    const isComplete = total > 0 && purchased === total;
                    
                    recipePurchaseStatus[currentRecipeId] = {
                        total: total,
                        purchased: purchased,
                        isComplete: isComplete
                    };
                    
                    // Re-render cards to update badge
                    renderRecipeCards();
                }
            } catch (error) {
                console.error('Error updating purchase status:', error);
            }
        }

        function updateShoppingSummary() {
            const summary = document.querySelector('.shopping-summary');
            if (!summary) return;
            
            const checkboxes = document.querySelectorAll('.ingredient-item input[type="checkbox"]');
            const totalCount = checkboxes.length;
            const purchasedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
            
            const summaryText = summary.querySelector('p:nth-child(2)');
            if (summaryText) {
                summaryText.innerHTML = `<strong>${totalCount}</strong> nguy√™n li·ªáu c·∫ßn mua`;
            }
            
            const purchasedText = summary.querySelector('p:nth-child(3)');
            if (purchasedText) {
                purchasedText.innerHTML = `<strong>${purchasedCount}</strong> ƒë√£ mua / <strong>${totalCount - purchasedCount}</strong> ch∆∞a mua`;
            }
        }
    </script>

    <style>
        .recipe-selector {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .search-section {
            margin-bottom: 20px;
        }

        .search-section label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filter-section {
            margin-bottom: 20px;
        }

        .filter-section label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
        }

        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 25px;
            font-size: 0.95em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            color: #666;
        }

        .filter-btn:hover {
            border-color: #667eea;
            color: #667eea;
            transform: translateY(-2px);
        }

        .filter-btn.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
        }

        .recipe-detail-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .recipe-detail-info p {
            margin: 10px 0;
            color: #555;
        }

        .recipes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 40px 0;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .pagination-btn {
            padding: 12px 24px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            border-color: #ccc;
            color: #ccc;
        }

        .page-info {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
        }

        .recipe-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }

        .recipe-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .recipe-card.recipe-complete {
            border: 2px solid #28a745;
            background: #f0f9f4;
        }

        .purchased-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #28a745;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 600;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .recipe-image {
            height: 150px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5em;
        }

        .recipe-body {
            padding: 20px;
        }

        .recipe-title {
            font-size: 1.2em;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .recipe-meta {
            display: flex;
            gap: 15px;
            margin: 10px 0;
            font-size: 0.9em;
            color: #666;
        }

        .recipe-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .recipe-rating {
            margin: 8px 0;
            font-size: 0.9em;
            color: #f39c12;
        }

        .recipe-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .tag {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .shopping-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 400px;
        }

        .shopping-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .shopping-summary h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .shopping-section {
            margin: 30px 0;
        }

        .shopping-section h3 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }

        .ingredients-checklist {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .ingredient-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .ingredient-item:hover {
            background: #e9ecef;
        }

        .ingredient-item.purchased {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }

        .ingredient-item.purchased label {
            opacity: 0.6;
        }

        .ingredient-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            cursor: pointer;
        }

        .ingredient-item label {
            flex: 1;
            display: flex;
            justify-content: space-between;
            cursor: pointer;
            transition: all 0.3s;
        }

        .ing-name {
            font-weight: 600;
            color: #333;
        }

        .ing-amount {
            color: #667eea;
            font-weight: 600;
        }

        .recipes-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .recipe-tag {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 500;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state p {
            font-size: 1.1em;
            margin: 10px 0;
        }

        /* Print styles */
        @media print {
            .main-layout {
                display: block;
            }

            .sidebar, .page-header button, .recipe-selector {
                display: none !important;
            }

            .shopping-content {
                box-shadow: none;
            }

            .ingredient-item {
                break-inside: avoid;
            }
        }
    </style>
</body>
</html>
